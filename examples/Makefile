########################################################################
# examples/Makefile : Build example executables for PaScaL_TDMA
#
# This Makefile compiles example programs that demonstrate how to use
# the PaScaL_TDMA CUDA-enabled TDMA solver.  
#
# Output:
#     run/a.out
#
# The example programs link against:
#     - Static library located in ../lib/
#     - Fortran module files located in ../include/
#
# This layout mirrors the structure used in PaScaL_TDMA 2.0 and enables
# clean separation between the core library and example applications.
########################################################################

include ../Makefile.inc

# ----------------------------------------------------------------------
# Directory configuration
#   BINDIR : Output directory for example executables
#   INCDIR : Directory containing module files generated by src/
#   LIBDIR : Directory containing the static library
# ----------------------------------------------------------------------
BINDIR = ../run
INCDIR = ../include
LIBDIR = ../lib

# ----------------------------------------------------------------------
# Target executable and object list
# ----------------------------------------------------------------------
EXE    = $(BINDIR)/a.out
OBJS   = ex_tdma_zdirection.o

.PHONY: all example clean

# ----------------------------------------------------------------------
# Default target: build example executable
# ----------------------------------------------------------------------
all: example


# ----------------------------------------------------------------------
# Build the example binary
# ----------------------------------------------------------------------
example: $(EXE)

$(EXE): $(OBJS)
	mkdir -p $(BINDIR)
	$(FC) $(FLAG) $(CUDAFLAG) -I$(INCDIR) -o $@ $(OBJS) -L$(LIBDIR) -lPaScaL_TDMA


# ----------------------------------------------------------------------
# Object file rule
#   - Uses module files from ../include/
#   - Applies both CPU/GPU flags from Makefile.inc
# ----------------------------------------------------------------------
%.o: %.f90
	$(FC) $(FLAG) $(CUDAFLAG) -I$(INCDIR) -c $< -o $@


# ----------------------------------------------------------------------
# Cleanup rule
# ----------------------------------------------------------------------
clean:
	rm -f *.o
